{
  "hash": "5c273fb52b0ba94ad838fb0de9925216",
  "result": {
    "markdown": "---\ntitle: \"Directed Acyclic Graphs\"\n---\n\n\n## DAG of the parking spots example\n\n\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-2_b24470124d11eb16cc340340517e239b'}\n\n```{.r .cell-code}\n# parking spots \nparking_spots <- dagify(\n  Y ~ X,\n  coords = list(x = c(X = 1, Y = 3),\n                y = c(X = 1, Y = 1)),\n  labels = list(X = \"having parking spots\",\n                Y = \"sales\")\n)\n\n# Plot DAG\nggdag(parking_spots) +\n  theme_dag() +\n  geom_dag_point(color = \"lightblue\") +\n  geom_dag_text(color = \"black\") +\n  geom_dag_edges(edge_color = \"black\") +\n  geom_dag_label_repel(aes(label = label))\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-2-1.png){width=672}\n:::\n:::\n\n\n## Customer satisfaction\n\n\n\n\n    \n1. Regress `satisfaction` on `follow_ups`\n    \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-4_d4e434b4e4a7b941dcd42047c6805e3e'}\n\n```{.r .cell-code}\nlm_sat_fol <- lm(satisfaction ~ follow_ups, data = customer_sat)\nsummary(lm_sat_fol)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups, data = customer_sat)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -12.412  -5.257   1.733   4.506  12.588 \n#> \n#> Coefficients:\n#>             Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)  78.8860     4.2717  18.467 1.04e-10 ***\n#> follow_ups   -3.3093     0.6618  -5.001 0.000243 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 7.923 on 13 degrees of freedom\n#> Multiple R-squared:  0.658,\tAdjusted R-squared:  0.6316 \n#> F-statistic: 25.01 on 1 and 13 DF,  p-value: 0.0002427\n```\n:::\n:::\n\n         \n2. Regress `satisfaction` on `follow_ups` and account for `subscription`\n    \n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-5_e941afa6d1344efae536cbec5d4ad230'}\n\n```{.r .cell-code}\nlm_sat_fol_subs <- lm(satisfaction ~ follow_ups + subscription, data = customer_sat)\nsummary(lm_sat_fol_subs)\n```\n\n::: {.cell-output .cell-output-stdout}\n```\n#> \n#> Call:\n#> lm(formula = satisfaction ~ follow_ups + subscription, data = customer_sat)\n#> \n#> Residuals:\n#>     Min      1Q  Median      3Q     Max \n#> -4.3222 -2.1972  0.3167  2.2667  3.9944 \n#> \n#> Coefficients:\n#>                      Estimate Std. Error t value Pr(>|t|)    \n#> (Intercept)           26.7667     6.6804   4.007  0.00206 ** \n#> follow_ups             2.1944     0.7795   2.815  0.01682 *  \n#> subscriptionPremium   44.7222     5.6213   7.956 6.88e-06 ***\n#> subscriptionPremium+  18.0722     2.1659   8.344 4.37e-06 ***\n#> ---\n#> Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1\n#> \n#> Residual standard error: 2.958 on 11 degrees of freedom\n#> Multiple R-squared:  0.9597,\tAdjusted R-squared:  0.9487 \n#> F-statistic: 87.21 on 3 and 11 DF,  p-value: 5.956e-08\n```\n:::\n:::\n\n\n## Comparison of coefficients\n\nThe coefficient in the first case (Regress `satisfaction` on `follow_ups`) is negative, meaning an increase in follow-up calls is related to a decrease in satisfaction. However, when we account for `subscription` in the linear regression, the coefficient indicates a positive linear relationship between follow-up calls and satisfaction. This is due to the fact that the number of follow-up calls depends on the subscription, which also affects the satisfaction degree. Thus, `subscription` is a cofounder and we would result in an incorrect result if we do not account for `subscription` when performing regression. The DAG for the example looks like this\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-6_e3dfda7ca537c05c4d7e664368df516d'}\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-6-1.png){width=672}\n:::\n:::\n\n\nLooking at the DAG above, we see that there is an indirect effect induced by `subscription` on the direct causal effect of `follow_ups` on `satisfaction`. The indirect effect is a spurious correlation which is irrelevant for our research, but can falsify our results if we do not conditioned on it. By accounting for `subscription` when regressing `satisfaction` on `follow_ups`, we condition on `subscription` and keep it at a fixed value. Thus, the values of `satisfaction` are purely dependent on the values of `follow_ups`, and we are able to retrieve the causal effect from `follow_ups` to `satisfaction`. \n\n## Plot\n\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-7_91ffe6b2fbb971985be246b1472c9e0d'}\n\n```{.r .cell-code}\n# Plot of first regression\nggplot(customer_sat, aes(x = follow_ups, y = satisfaction,)) +\n  geom_point(color = \"cornflowerblue\") +\n  stat_smooth(method = \"lm\", se = F, color = \"coral2\", formula = y ~ x)\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-7-1.png){width=672}\n:::\n:::\n\n::: {.cell hash='05_dag_cache/html/unnamed-chunk-8_40c6178086af5e57a83d4a8e1facc598'}\n\n```{.r .cell-code}\n# Plot of second regression\nggplot(customer_sat, aes(x = follow_ups, y = satisfaction,\n                            color = subscription, \n                            alpha = subscription)) +\n  geom_point() +\n  stat_smooth(method = \"lm\", se = F, formula = y ~ x) +\n  scale_color_manual(values = c(\"Premium\"=\"darkolivegreen3\",\n                                \"Premium+\"=\"cornflowerblue\",\n                                \"Elite\"=\"coral2\")) +\n  scale_alpha_manual(values = c(1,1, 1)) +\n  theme(legend.position = \"right\")\n```\n\n::: {.cell-output-display}\n![](05_dag_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<link href=\"../../site_libs/pagedtable-1.1/css/pagedtable.css\" rel=\"stylesheet\" />\r\n<script src=\"../../site_libs/pagedtable-1.1/js/pagedtable.js\"></script>\r\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}